
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Working with the Entity-Component System &#8212; Orrery 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="./working_with_ecs.html" />
    <link rel="icon" href="_static/OrreryLogo.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modeling Relationships" href="relationships.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="working-with-the-entity-component-system">
<h1>Working with the Entity-Component System<a class="headerlink" href="#working-with-the-entity-component-system" title="Permalink to this heading">¶</a></h1>
<p>Orrey uses a custom entity-component system (ECS) to drive things. It is what
allows orrery to be flexible to new content without users needing to extend
the core library code.</p>
<p>ECS seems to be all the rage lately, with Unity introducing entities in its
Data-Oriented Technology Stack and their popularity among rougelike designers.</p>
<p>If you are unfamiliar with ECSs then we will do a brief primer before
explaining how to navigate Orrery’s.</p>
<section id="general-ecs-overview">
<h2>General ECS overview<a class="headerlink" href="#general-ecs-overview" title="Permalink to this heading">¶</a></h2>
<p>ECSs are designed to be an optimization strategy for data-intensive applications
such as games and simulations. The main idea is to separate data from the
processes that operate on that data. Then all similar data structures are stored
together in memory to improve runtime performance by reducing cache misses.</p>
<p>Within an ECS, the world is represented as a collection of entities. Each
entity has a set of components associated with it. Components are collections of
related data that model a particular aspect of the simulation. For example, a
<em>Position2D</em> component might contain two numerical values, <em>x</em> and <em>y</em>. Systems
are functions that manipulate the data within components to update the simulation.</p>
<p>If you want a more in-depth discussion, please refer to this <a class="reference external" href="https://github.com/SanderMertens/ecs-faq#what-is-ecs">FAQ article from
the Flecs ECS library</a>.</p>
</section>
<section id="overview-of-orrery-s-ecs">
<h2>Overview of Orrery’s ECS<a class="headerlink" href="#overview-of-orrery-s-ecs" title="Permalink to this heading">¶</a></h2>
<p>Orrery uses a custom entity-component system built on top of
<a class="reference external" href="https://github.com/benmoran56/esper">Esper</a> that integrates features from
other ECS and component-based architectures, like Unity’s <em>GameObjects</em> or global
resource object in
<a class="reference external" href="https://bevyengine.org/learn/book/getting-started/ecs/">Bevy’s ECS</a>.</p>
<section id="gameobjects">
<h3>GameObjects<a class="headerlink" href="#gameobjects" title="Permalink to this heading">¶</a></h3>
<p>In Orrey, we call entities, GameObjects. Each GameObject has a unique integer
identifier, a name, and a collection of components.</p>
</section>
<section id="components">
<h3>Components<a class="headerlink" href="#components" title="Permalink to this heading">¶</a></h3>
<p>The Component class is an abstract base class inherited by any object that
is intended to be used as a component. It gives subclasses a reference to
the gameobject reference and provides utility methods for tasks like
serializing to a dictionary object.</p>
</section>
<section id="systems">
<h3>Systems<a class="headerlink" href="#systems" title="Permalink to this heading">¶</a></h3>
<p>Systems are objects that inherit from <code class="docutils literal notranslate"><span class="pre">ISystem</span></code> or <code class="docutils literal notranslate"><span class="pre">System</span></code>. They
override a <code class="docutils literal notranslate"><span class="pre">process</span></code>/<code class="docutils literal notranslate"><span class="pre">run</span></code> method that gets called every timestep of
the simulation or on a specified interval. Systems can access GameObjects and
their components by querying the world instance for GameObjects containing
particular components.</p>
</section>
<section id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this heading">¶</a></h3>
<p>Resources are shared object instances that are accessible from the world.
Orrery uses resource classes to manage configuration data, authored content,
simulation time, random number generation, and more.</p>
</section>
<section id="world">
<h3>World<a class="headerlink" href="#world" title="Permalink to this heading">¶</a></h3>
<p>The World manages all the active GameObjects, Systems, and Resources. Users
can use the world state to retrieve gameobjects or search for ones that have
certain components.</p>
</section>
</section>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">orrery.core.ecs</span> <span class="kn">import</span> <span class="n">World</span>

<span class="c1"># Creates a new world instance</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">()</span>

<span class="c1"># Add a random number generator as a global resource</span>
<span class="n">world</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">Actor</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;dollars&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dollars</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dollars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">dollars</span>


<span class="k">class</span> <span class="nc">Job</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;salary&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salary</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salary</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">salary</span>


<span class="k">class</span> <span class="nc">SalarySystem</span><span class="p">(</span><span class="n">System</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Increases a characters money by their salary amount&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">guid</span><span class="p">,</span> <span class="p">(</span><span class="n">money</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span> <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="n">Money</span><span class="p">,</span> <span class="n">Job</span><span class="p">):</span>
            <span class="c1"># The code below may give errors in some IDEs because</span>
            <span class="c1"># the typing isn&#39;t the best for Generic return types.</span>
            <span class="c1"># There are two solutions to solve this</span>
            <span class="c1"># 1) Add &#39;# type: ignore&#39; to the left of the code</span>
            <span class="c1"># 2) Import &#39;cast&#39; from typing and then</span>
            <span class="c1">#    money = cast(Money, money)</span>
            <span class="c1">#    job = cast(Job, job)</span>
            <span class="n">money</span><span class="o">.</span><span class="n">dollars</span> <span class="o">+=</span> <span class="n">job</span><span class="o">.</span><span class="n">salary</span>

<span class="c1"># You need to register the component with the world instance</span>
<span class="c1"># to use it with the YAML authoring interface</span>
<span class="n">world</span><span class="o">.</span><span class="n">register_component</span><span class="p">(</span><span class="n">Money</span><span class="p">)</span>

<span class="c1"># Create a new character</span>
<span class="n">alice</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">spawn_gameobject</span><span class="p">([</span>
    <span class="n">Actor</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">),</span>
    <span class="n">Money</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Add the system ti the world</span>
<span class="n">world</span><span class="o">.</span><span class="n">add_system</span><span class="p">(</span><span class="n">SalarySystem</span><span class="p">())</span>

<span class="c1"># Stepping the simulation while Alice has no job will not</span>
<span class="c1"># change her current money</span>
<span class="n">world</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">alice</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="n">Money</span><span class="p">)</span><span class="o">.</span><span class="n">dollars</span> <span class="o">==</span> <span class="mi">10</span>

<span class="c1"># Adding a Job component makes Alice appear in the SalarySystem&#39;s</span>
<span class="c1"># world.get_components(...) query.</span>
<span class="n">alice</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">Job</span><span class="p">(</span><span class="s2">&quot;CEO&quot;</span><span class="p">,</span> <span class="mi">500_000</span><span class="p">))</span>

<span class="c1"># Now stepping the simulation should allow Alice to get paid</span>
<span class="n">world</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">alice</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="n">Money</span><span class="p">)</span><span class="o">.</span><span class="n">dollars</span> <span class="o">==</span> <span class="mi">500_010</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/OrreryLogo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">Orrery</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with the Entity-Component System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-ecs-overview">General ECS overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-orrery-s-ecs">Overview of Orrery’s ECS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="relationships.html">Modeling Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_driven_architecture.html">Orrery’s Event Architecture</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="relationships.html" title="next chapter">Modeling Relationships</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2023, Shi Johnson-Bey.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/working_with_ecs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>